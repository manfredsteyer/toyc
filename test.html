<!-- POC for demo -->
<script src="https://webassembly.github.io/wabt/demo/libwabt.js"></script>

<script>

  WabtModule().then(function (wabt) {

    let textContent = '';
    let wat = `
      (module
      (func (export "addTwo") (param i32 i32) (result i32)
        local.get 0
        local.get 1
        i32.add))
    `;

    var binaryOutput;
    var binaryBuffer = null;

    try {
      var module = wabt.parseWat('test.wast', wat, {});
      module.resolveNames();
      module.validate({});
      var binaryOutput = module.toBinary({ log: true, write_debug_names: true });
      console.debug(binaryOutput.log);
      binaryBuffer = binaryOutput.buffer;


      let wasmModule = new WebAssembly.Module(binaryBuffer);

      const wasmInstance =
        new WebAssembly.Instance(wasmModule, {});
      const { addTwo } = wasmInstance.exports;
      for (let i = 0; i < 10; i++) {
        console.log(addTwo(i, i));
      }

    } catch (e) {
      console.error(e.toString());

    } finally {
      if (module) module.destroy();
    }
  });
</script>